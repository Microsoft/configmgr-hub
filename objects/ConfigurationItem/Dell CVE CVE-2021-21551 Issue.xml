<?xml version="1.0" encoding="utf-16"?>
<DesiredConfigurationDigest xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/07/10/DesiredConfiguration">
  <!--Authored against the following schema version: 5-->
  <OperatingSystem AuthoringScopeId="ScopeId_96966290-7C86-45F7-9623-B88938BD645D" LogicalName="OperatingSystem_bdf0dffe-e482-4583-93a3-18d3fc6767db" Version="3">
    <Annotation xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules">
      <DisplayName Text="Dell CVE CVE-2021-21551 Issue" ResourceId="ID-e45e2e94-4a41-4252-9e31-4c0fe7552214" />
      <Description Text="" />
    </Annotation>
    <Parts>
      <SuppressionReferences />
    </Parts>
    <Settings>
      <RootComplexSetting>
        <SimpleSetting LogicalName="ScriptSetting_bffabb8f-4a67-4f41-9be6-c1099216bb50" DataType="Boolean">
          <Annotation xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules">
            <DisplayName Text="CVE CVE-2021-21551 Detection" ResourceId="ID-12288c61-6890-4ec8-80d3-ed663ed481d9" />
            <Description Text="" />
          </Annotation>
          <ScriptDiscoverySource Is64Bit="true">
            <DiscoveryScriptBody ScriptType="PowerShell">&lt;#	
	.NOTES
	===========================================================================
	 Created with: 	SAPIEN Technologies, Inc., PowerShell Studio 2021 v5.8.188
	 Created on:   	05/05/2021 18:15
	 Created by:   	MauriceDaly
	 Organization: 	Cloudway
	 Filename:     	Detect-CVE202121551-CM.ps1
	===========================================================================
	.DESCRIPTION
		Searches for dbutil_2_3.sys assoicated with Dell CVE-2021-21551
#&gt;

function DetectCVEIssue {
	$SystemFile = "dbutil_2_3.sys"
	$UserProfileSearch = (Get-ChildItem -Path C:\Users -Filter $SystemFile -Recurse -ErrorAction SilentlyContinue)
	$TempSearch = (Get-ChildItem -Path C:\Windows\Temp -Filter $SystemFile -Recurse -ErrorAction SilentlyContinue)
	if ([boolean]$UserProfileSearch -eq $true -or [boolean]$TempSearch -eq $true) {
		Return $True
	} else {
		Return $False
	}
}

DetectCVEIssue</DiscoveryScriptBody>
            <RemediationScriptBody ScriptType="PowerShell">&lt;#	
	.NOTES
	===========================================================================
	 Created with: 	SAPIEN Technologies, Inc., PowerShell Studio 2021 v5.8.188
	 Created on:   	05/05/2021 18:15
	 Created by:   	MauriceDaly
	 Organization: 	Cloudway
	 Filename:     	Remove-CVE202121551-CM.ps1
	===========================================================================
	.DESCRIPTION
		Searches for and removes dbutil_2_3.sys assoicated with Dell CVE-2021-21551
#&gt;

function RemediateCVEIssue {
	$SystemFile = "dbutil_2_3.sys"
	$UserProfileSearch = (Get-ChildItem -Path C:\Users -Filter $SystemFile -Recurse -ErrorAction SilentlyContinue)
	$TempSearch = (Get-ChildItem -Path C:\Windows\Temp -Filter $SystemFile -Recurse -ErrorAction SilentlyContinue)
	if ([boolean]$UserProfileSearch -eq $true -or [boolean]$TempSearch -eq $true) {
		Write-Output "Dell dbutil_2_3.sys file has been detected"
		if (-not ([string]::IsNullOrEmpty($UserProfileSearch.FullName))) {
			foreach ($File in $UserProfileSearch.FullName) {
				Remove-Item -Path $File -Verbose
				Write-Output "Removed Dell $SystemFile from $File"
			}
		}
		if (-not ([string]::IsNullOrEmpty($TempSearch.FullName))) {
			foreach ($File in $TempSearch.FullName) {
				Remove-Item -Path $File -Verbose
				Write-Output "Removed Dell $SystemFile from $File"
			}
		}
	} else {
		Write-Output "Dell dbutil_2_3.sys file not present on system"
	}
}

RemediateCVEIssue</RemediationScriptBody>
          </ScriptDiscoverySource>
        </SimpleSetting>
      </RootComplexSetting>
    </Settings>
    <Rules>
      <Rule xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules" id="Rule_6dfed4cf-b382-4902-9ce9-ccacda213b08" Severity="None" NonCompliantWhenSettingIsNotFound="false">
        <Annotation>
          <DisplayName Text="Dell CVE-2021-21551 Compliance" ResourceId="ID-1a7bb693-baa2-4c7e-9ca9-0392313147dd" />
          <Description Text="" />
        </Annotation>
        <Expression>
          <Operator>Equals</Operator>
          <Operands>
            <SettingReference AuthoringScopeId="ScopeId_96966290-7C86-45F7-9623-B88938BD645D" LogicalName="OperatingSystem_bdf0dffe-e482-4583-93a3-18d3fc6767db" Version="3" DataType="Boolean" SettingLogicalName="ScriptSetting_bffabb8f-4a67-4f41-9be6-c1099216bb50" SettingSourceType="Script" Method="Value" Changeable="true" />
            <ConstantValue Value="False" DataType="Boolean" />
          </Operands>
        </Expression>
      </Rule>
    </Rules>
    <OperatingSystemDiscoveryRule xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules">
      <OperatingSystemExpression>
        <Operator>OneOf</Operator>
        <Operands>
          <RuleExpression RuleId="Windows/All_ARM64_Windows_10_and_higher_Clients" />
          <RuleExpression RuleId="Windows/All_MultiSession_Enterprise_Windows_10_higher" />
          <RuleExpression RuleId="Windows/All_x64_Windows_10_and_higher_Clients" />
          <RuleExpression RuleId="Windows/All_x86_Windows_10_and_higher_Clients" />
        </Operands>
      </OperatingSystemExpression>
    </OperatingSystemDiscoveryRule>
  </OperatingSystem>
</DesiredConfigurationDigest>